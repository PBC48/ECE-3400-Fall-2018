<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>The 7-Ups - ECE 3400 Fall 2018 Team 7</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- Plugin CSS -->
    <link href="vendor/magnific-popup/magnific-popup.css" rel="stylesheet" type="text/css">

    <!-- Custom styles for this template -->
    <link href="css/freelancer.css" rel="stylesheet">

  </head>

  <body id="page-top">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg bg-secondary fixed-top text-uppercase" id="mainNav">
      <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="#page-top">The 7-Ups</a>
        <button class="navbar-toggler navbar-toggler-right text-uppercase bg-primary text-white rounded" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          Menu
          <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item mx-0 mx-lg-1">
              <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#members">Members</a>
            </li>
            <li class="nav-item mx-0 mx-lg-1">
              <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#contract">Contract</a>
            </li>
            <li class="nav-item mx-0 mx-lg-1">
              <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#ethics">Ethics</a>
            </li>
            <li class="nav-item mx-0 mx-lg-1">
              <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#labs">Labs</a>
            </li>
            <li class="nav-item mx-0 mx-lg-1">
              <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#milestones">Milestones</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Header -->
    <header class="masthead bg-primary text-white text-center">
      <div class="container">
        <img class="img-fluid mb-5 d-block mx-auto" src="images/bootstrap/header.png" alt="">
        <h1 class="text-uppercase mb-0">The 7-Ups</h1>
        <hr class="star-light">
        <h2 class="font-weight-light mb-0">ECE 3400 2018 Lab Group 7</h2>
      </div>
    </header>

    <!-- Portfolio Grid Section -->
    <section class="portfolio" id="members">
      <div class="container">
        <h2 class="text-center text-uppercase text-secondary mb-0">Members</h2>
        <hr class="star-dark mb-5">
        <div class="row">
          <div class="col-md-6 col-lg-6">
            <a class="portfolio-item d-block mx-auto" href="#headshot-1">
              <div class="portfolio-item-caption d-flex position-absolute h-100 w-100">
                <div class="portfolio-item-caption-content my-auto w-100 text-center text-white">
                  <i class="fas fa-search-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="images/headshot-Xiaoyu.PNG" alt="">
            </a>
          </div>
          <div class="col-md-6 col-lg-6">
            <a class="portfolio-item d-block mx-auto" href="#headshot-2">
              <div class="portfolio-item-caption d-flex position-absolute h-100 w-100">
                <div class="portfolio-item-caption-content my-auto w-100 text-center text-white">
                  <i class="fas fa-search-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="images/headshot-Chrissy.png" alt="">
            </a>
          </div>
          <div class="col-md-6 col-lg-6">
            <a class="portfolio-item d-block mx-auto" href="#headshot-3">
              <div class="portfolio-item-caption d-flex position-absolute h-100 w-100">
                <div class="portfolio-item-caption-content my-auto w-100 text-center text-white">
                  <i class="fas fa-search-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="images/headshot-Patrick.png" alt="">
            </a>
          </div>
          <div class="col-md-6 col-lg-6">
            <a class="portfolio-item d-block mx-auto" href="#headshot-4">
              <div class="portfolio-item-caption d-flex position-absolute h-100 w-100">
                <div class="portfolio-item-caption-content my-auto w-100 text-center text-white">
                  <i class="fas fa-search-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="images/bootstrap/lab4-bootstrap.png" alt="">
            </a>
          </div>
       </div>
    </section>

    <section class="portfolio" id="contract">
      <div class="container">
        <h2 class="text-center text-uppercase text-secondary mb-0">Contract</h2>
        <hr class="star-dark mb-5">
        <div class="row">
          <div class="col-md-12 col-lg-12">
            <a class="portfolio-item d-block mx-auto" href="#headshot-1">
              <div class="portfolio-item-caption d-flex position-absolute h-100 w-100">
                <div class="portfolio-item-caption-content my-auto w-100 text-center text-white">
                  <i class="fas fa-search-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="images/headshot-Xiaoyu.PNG" alt="">
            </a>
          </div>
       </div>
    </section>
      
    <section class="portfolio" id="ethics">
      <div class="container">
        <h2 class="text-center text-uppercase text-secondary mb-0">Ethics</h2>
        <hr class="star-dark mb-5">
        <div class="row">
          <div class="col-md-12 col-lg-12">
            <a class="portfolio-item d-block mx-auto" href="#headshot-1">
              <div class="portfolio-item-caption d-flex position-absolute h-100 w-100">
                <div class="portfolio-item-caption-content my-auto w-100 text-center text-white">
                  <i class="fas fa-search-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="images/headshot-Xiaoyu.PNG" alt="">
            </a>
          </div>
       </div>
    </section>
                    
    <section class="portfolio" id="labs">
      <div class="container">
        <h2 class="text-center text-uppercase text-secondary mb-0">Labs</h2>
        <hr class="star-dark mb-5">
        <div class="row">
          <div class="col-md-6 col-lg-3">
            <a class="portfolio-item d-block mx-auto" href="#portfolio-modal-1">
              <div class="portfolio-item-caption d-flex position-absolute h-100 w-100">
                <div class="portfolio-item-caption-content my-auto w-100 text-center text-white">
                  <i class="fas fa-search-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="images/bootstrap/lab1-bootstrap.png" alt="">
            </a>
          </div>
          <div class="col-md-6 col-lg-3">
            <a class="portfolio-item d-block mx-auto" href="#portfolio-modal-2">
              <div class="portfolio-item-caption d-flex position-absolute h-100 w-100">
                <div class="portfolio-item-caption-content my-auto w-100 text-center text-white">
                  <i class="fas fa-search-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="images/bootstrap/lab2-bootstrap.png" alt="">
            </a>
          </div>
          <div class="col-md-6 col-lg-3">
            <a class="portfolio-item d-block mx-auto" href="#portfolio-modal-3">
              <div class="portfolio-item-caption d-flex position-absolute h-100 w-100">
                <div class="portfolio-item-caption-content my-auto w-100 text-center text-white">
                  <i class="fas fa-search-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="images/bootstrap/lab3-bootstrap.png" alt="">
            </a>
          </div>
          <div class="col-md-6 col-lg-3">
            <a class="portfolio-item d-block mx-auto" href="#portfolio-modal-4">
              <div class="portfolio-item-caption d-flex position-absolute h-100 w-100">
                <div class="portfolio-item-caption-content my-auto w-100 text-center text-white">
                  <i class="fas fa-search-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="images/bootstrap/lab4-bootstrap.png" alt="">
            </a>
          </div>
       </div>
    </section>
      
    <section class="portfolio" id="milestones">
      <div class="container">
        <h2 class="text-center text-uppercase text-secondary mb-0">Milestones</h2>
        <hr class="star-dark mb-5">
        <div class="row">
          <div class="col-md-6 col-lg-3">
            <a class="portfolio-item d-block mx-auto" href="#portfolio-modal-5">
              <div class="portfolio-item-caption d-flex position-absolute h-100 w-100">
                <div class="portfolio-item-caption-content my-auto w-100 text-center text-white">
                  <i class="fas fa-search-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="img/portfolio/safe.png" alt="">
            </a>
          </div>
          <div class="col-md-6 col-lg-3">
            <a class="portfolio-item d-block mx-auto" href="#portfolio-modal-6">
              <div class="portfolio-item-caption d-flex position-absolute h-100 w-100">
                <div class="portfolio-item-caption-content my-auto w-100 text-center text-white">
                  <i class="fas fa-search-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="img/portfolio/submarine.png" alt="">
            </a>
          </div>
          <div class="col-md-6 col-lg-3">
            <a class="portfolio-item d-block mx-auto" href="#portfolio-modal-7">
              <div class="portfolio-item-caption d-flex position-absolute h-100 w-100">
                <div class="portfolio-item-caption-content my-auto w-100 text-center text-white">
                  <i class="fas fa-search-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="img/portfolio/submarine.png" alt="">
            </a>
          </div>
          <div class="col-md-6 col-lg-3">
            <a class="portfolio-item d-block mx-auto" href="#portfolio-modal-8">
              <div class="portfolio-item-caption d-flex position-absolute h-100 w-100">
                <div class="portfolio-item-caption-content my-auto w-100 text-center text-white">
                  <i class="fas fa-search-plus fa-3x"></i>
                </div>
              </div>
              <img class="img-fluid" src="img/portfolio/submarine.png" alt="">
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer text-center">
      <div class="container">
        <div class="row">
          <div class="col-md-6 mb-5 mb-lg-6">
            <h4 class="text-uppercase mb-4">Check us on Linkedin</h4>
            <ul class="list-inline mb-0">
              <li class="list-inline-item">
                <a class="btn btn-outline-light btn-social text-center rounded-circle" href="#">
                  <i class="fab fa-fw fa-facebook-f"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a class="btn btn-outline-light btn-social text-center rounded-circle" href="#">
                  <i class="fab fa-fw fa-google-plus-g"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a class="btn btn-outline-light btn-social text-center rounded-circle" href="#">
                  <i class="fab fa-fw fa-twitter"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a class="btn btn-outline-light btn-social text-center rounded-circle" href="#">
                  <i class="fab fa-fw fa-linkedin-in"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a class="btn btn-outline-light btn-social text-center rounded-circle" href="#">
                  <i class="fab fa-fw fa-dribbble"></i>
                </a>
              </li>
            </ul>
          </div>
          <div class="col-md-6">
            <h4 class="text-uppercase mb-4">About The 7-Ups</h4>
            <p class="lead mb-0">The 7-Ups is just your average run-of-the-mill junior and senior group.
              Fun fact: 3 of us are in the Big Red Marching Band. One of us plays soccer for Cornell.</p>
          </div>
        </div>
      </div>
    </footer>
    <div class="copyright py-4 text-center text-white">
      <div class="container">
        <small>Copyright would go here, but we don't need it.</small>
      </div>
    </div>

    <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
    <div class="scroll-to-top d-lg-none position-fixed ">
      <a class="js-scroll-trigger d-block text-center text-white rounded" href="#page-top">
        <i class="fa fa-chevron-up"></i>
      </a>
    </div>

    <!-- Portfolio Modals -->

    <!-- Portfolio Modal 1 -->
    <div class="portfolio-modal mfp-hide" id="portfolio-modal-1">
      <div class="portfolio-modal-dialog bg-white">
        <a class="close-button d-none d-md-block portfolio-modal-dismiss" href="#">
          <i class="fa fa-4x fa-times"></i>
        </a>
        <div class="container text-center">
          <div class="row">
            <div class="col-lg-6 mx-auto">
              <h2 class="text-secondary text-uppercase mb-0">Lab 1: Microcontrollers</h2>
              <hr class="star-dark mb-5">
              <img class="img-fluid mb-5" src="images/bootstrap/lab1-bootstrap.png" alt="">
              <p class="mb-5">
                <h3>Objectives</h3>
                <ul ALIGN=LEFT>
                  <li>Familiarize ourselves with the Arduino IDE and Arduino Uno</li>
                  <li>Learn introductory Arduino programming and basic Arduino functionalities</li>
                  <li>Create simple circuits and Arduino programs to explore digital and analog Arduino I/O ports, built-in Arduino functions, and serial communication</li>
                  <li>Construct our robot and write a program to make it move in a square</li>
                </ul>
                <br/>
                <h3>Introduction</h3>
                <p ALIGN=LEFT>In Lab 1, we began with using digital I/O pins to make internal and external LEDs blink.
                  We then used a potentiometer to explore using analog circuits with the Arduino. We started 
                  by simply reading out analog values from the potentiometer on the serial port. Then we used 
                  these values to adjust the brightness of an external LED and the speed of a continuously 
                  rotating servo. The lab culminated in building a functional robot that could drive autonomously in a square.
                </p>
                <br/>
                <h3>Blink</h3>
                <p ALIGN=LEFT>We made the Uno’s built-in LED blink by running an Arduino example code, found as follows:</p>
                <figure ALIGN=CENTER>
                  <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/blinkAccessScreenshot.png" width="560"/>
                  <font size="2">
                    <figcaption> Blinking LED example code location
                    </figcaption>
                  </font>
                </figure>
                <p ALIGN=LEFT>The code worked as expected, as can be seen by the 
                  following demonstration of the internal LED blinking:
                </p>
                <iframe ALIGN=LEFT width="560" height="315" 
                      src="https://www.youtube.com/embed/pbVh3dkpa-c?rel=0&amp;controls=0&amp;showinfo=0" frameborder="0"
                      allow="autoplay; encrypted-media" allowfullscreen>
                </iframe>
                <br/>
                <br/>
                <h3>Serial Monitor and Analog Pins</h3>
                <p ALIGN=LEFT>To experiment with using the serial monitor and analog pins, 
                  we tested reading values from a potentiometer. We connected the potentiometer 
                  to the Arduino by connecting its output to an analog input pin of the Arduino, 
                  and connecting the potentiometer to the Arduino's 5V power and ground. To avoid 
                  accidentally short-circuiting the LED, we also added a 300 Ohm resistance in 
                  series with the potentiometer. We used the analogRead() function to read the 
                  potentiometer values and used the Serial.println() function to print those values 
                  to the serial monitor. These functions are included in the code for the LED analog 
                  output.
                </p>
                <br/>
                <h3>LED Analog Output</h3>
                <p ALIGN=LEFT>Next, we used the analog output from the potentiometer to control the 
                  brightness of the LED. After reading the potentiometer value, we adjusted that value 
                  and used the analogWrite() function to output it to an Arduino pin with PWM 
                  capability (pin 10 in the code below). We had to adjust the output value to be within 
                  the range accepted by the analogWrite() function; the potentiometer readings returned 
                  values between 0 and 1023, and the analogWrite() function accepts values between 0 and 
                  255.
                </p>
                <figure ALIGN=LEFT>
                  <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/Code-analog.PNG" width="560">
                  <font size="2">
                  <figcaption> Writing Potentiometer Values to LED Code
                  </figcaption>
                  </font>
                </figure>
                <p ALIGN=LEFT>We set up a circuit according to the following schematic, similar to what we 
                  had already set up to read the potentiometer values and adding the connection of the LED
                  to a PWM pin:
                </p>
                <figure ALIGN=LEFT>
                  <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/Schematic-PotentiometerBlink.PNG" width="560">
                  <font size="2">
                  <figcaption> Schematic for controlling LED brightness with potentiometer
                  </figcaption>
                  </font>
                </figure>
                <br/>
                <h3>Servo</h3>
                <p ALIGN=LEFT>We used the Arduino analog I/O pins to control the turn direction and speed of
                  continuously rotating servos. We relied primarily on the Arduino’s servo library to control
                  the servo. On a high level, we dictated which analog I/O port (PWM pin) would be used to 
                  control the servos and then used the write function of the servo library to dictate the speed 
                  and direction of the servo. We combined the servo with the potentiometer in a similar way to 
                  what we did with the potentiometer and LED, allowing the potentiometer to control the speed 
                  and direction of the servo by adjusting the value read from the potentiometer and writing it 
                  to the servo via a PWM pin (pin 10 in the code below).
                </p>
                <figure ALIGN=CENTER>
                  <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/Code-Servo.PNG" width="560">
                  <font size="2">
                  <figcaption> Writing Potentiometer Values to Servo Code
                  </figcaption>
                  </font>
                </figure>
                <p ALIGN=LEFT>We set up a circuit according to the schematic below, similar to what we had 
                  created for the LED and adding in the servo connection to the PWM pin and the Arduino circuit:
                </p>
                <figure ALIGN=CENTER>
                  <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/Schematic-ServoPotentiometer.PNG" width="560">
                  <font size="2">
                  <figcaption> Schematic for controlling servo with potentiometer
                  </figcaption>
                  </font>
                </figure>
                <p ALIGN=LEFT>Adjusting the potentiometer changed the speed and direction of the servo as we 
                  expected, and as is shown in the following demonstration of servos controlled via the potentiometer:
                </p>
                <iframe ALIGN=CENTER width="560" height="315" 
                        src="https://www.youtube.com/embed/rJJShOBNLfM?rel=0&amp;controls=0&amp;showinfo=0" 
                        frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
                </iframe>
                <br/>
                <h3>Robot</h3>
                <p>We built the robot consisting of a chassis and two servos with wheels attached, and mounted 
                  the Arduino on top of the chassis.  We also attached a 5V DC phone charging port to power the 
                  robot.  Finally, we wrote a simple Arduino program for the robot to drive in a square.
                </p>
                <figure ALIGN=CENTER>
                  <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/robot.jpg" width="560">
                  <font size="2">
                  <figcaption> Assembled Robot
                  </figcaption>
                  </font>
                </figure>

                <figure ALIGN=CENTER>
                  <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/Code-robotDrive.PNG" width="560">
                  <font size="2">
                  <figcaption> Robot Square Driving Code
                  </figcaption>
                  </font>
                </figure>

                <p ALIGN=LEFT>The circuit on the robot is set up according the following schematic:</p>

                <figure ALIGN=CENTER>
                  <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/Schematic-Robot.PNG" width="560">
                  <font size="2">
                  <figcaption> Schematic for current robot
                  </figcaption>
                  </font>
                </figure>
                <p ALIGN=LEFT>The robot was able to move autonomously as we had directed, as shown in the following 
                  demonstration of the robot moving in a square:
                </p>

                <iframe ALIGN=CENTER width="560" height="315" 
                        src="https://www.youtube.com/embed/az1fnLFKQlA?rel=0&amp;controls=0&amp;showinfo=0&amp;start=1" 
                        frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
                </iframe>
                <br/>
                <h3>Conclusion and Result</h3>
                <p ALIGN=LEFT>The robot moved as expected in the square and there were no problems with the speed of the servos. 
                  However, we did encounter a problem with the direction of one of the motors.  The orientation of the 
                  two motors was inconsistent so the right and left wheels spun in opposite directions.  This slightly 
                  complicated the code to direct the robot, requiring a roundabout solution even to go in a straight line. 
                  In the next lab section, we will fix the installation of the wheels by reversing the orientation of one 
                  of the wheels.
                </p> 
              </p>
              <a class="btn btn-primary btn-lg rounded-pill portfolio-modal-dismiss" href="#">
                <i class="fa fa-close"></i>
                Close Project</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Portfolio Modal 2 -->
    <div class="portfolio-modal mfp-hide" id="portfolio-modal-2">
      <div class="portfolio-modal-dialog bg-white">
        <a class="close-button d-none d-md-block portfolio-modal-dismiss" href="#">
          <i class="fa fa-4x fa-times"></i>
        </a>
        <div class="container text-center">
          <div class="row">
            <div class="col-lg-6 mx-auto">
              <h2 class="text-secondary text-uppercase mb-0">Lab 2 : Analog Circuitry and FFTs</h2>
              <hr class="star-dark mb-5">
              <img class="img-fluid mb-5" src="images/bootstrap/lab2-bootstrap.png" alt="">
              <p class="mb-5">
                <h3>Objectives</h3>
                <ul ALIGN=LEFT>
                  <li>Understand and Utilize the FFT Library
                  <li>Implement 660Hz Tone Detection
                  <li>Implement 6.08kHz IR signal detection, ignoring decoys
                </ul>
                <h3>Introduction</h3>
                <p ALIGN=LEFT>
                  In lab 2, we added hardware sensors and signal processing capabilities to the robot. 
                  We split into two subteams, with Tara and Chrissy working on acoustics and Xiaoyu and 
                  Patrick on optical sensing. The start of our final maze will commence with a 660 Hz 
                  whistle blow, so the acoustic team used an Electret microphone and an amplifying circuit 
                  to detect the tone and distinguish it from background noise.  The optical group used an 
                  IR transistor to detect other robots emitting IR at 6.08kHz, and ignore decoys (18kHz).
                </p>
                <h3>FFT Analysis</h3>
                <p ALIGN=LEFT>
                  The “Fast Fourier Transform” is an operation that uses the Discrete Time Fourier Transform 
                  in a time-efficient method to sample a signal over time and return its frequency components. 
                  Because both sub teams had to implement algorithms to detect specific frequencies in a noisy 
                  environment, we began the lab by familiarizing ourselves with the Arduino Open Music Labs FFT 
                  library in order to allow us to use digital filters to process these signals. We each 
                  installed the library in our Arduino IDE and studied the example script fft_adc_serial, 
                  with the goal of understanding how to use the FFT library and identifying the frequency 
                  bin where we should look for our signal. First, we looked at the sampling frequency of 
                  the ADC. There are two ways to identify this rate -- the first is to use the oscilloscope
                  and the <code>digitalWrite()</code> function to change the state of the digital pin whenever the ADC 
                  finishes one conversion. The scope will then measure the frequency of the output wave. 
                  Based on our implementation, we know that the ADC converts two values per period, so the 
                  frequency is about 38 kHz.  
                </p>
                <figure ALIGN-LEFT>
                    <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/lab02/frequency%20of%20ADC.PNG" width="560"/>
                    <font size="2">
                    <figcaption> <b> Frequency of the ADC </b>
                    </figcaption>
                    </font>
                </figure>
                <br/>
                <p ALIGN=LEFT>
                  To confirm this result, we referenced Section 28 of the ATmega328 datasheet, which provides 
                  information about the ADC. It indicates that the last 3 bits of the ADC Control and Status 
                  Register A determine a prescalar by which the Arduino clock frequency is divided to determine 
                  the ADC clock frequency. The example script fft_adc_serial sets this division factor to 32 in 
                  the second line of the code snippet below.  Given the 16MHz Arduino system clock frequency and 
                  the 13 clock cycles it takes the ADC to convert, we used the formula (Arduino clock cycle / 
                  total conversion clock cycles / prescalar) to find the 38 kHz sampling frequency. 
                  <br/>
                  Calling the FFT function is simple using the Music Labs' library where we first must setup the ADC settings:
                </p>
<pre ALIGN=LEFT style='color:#000000;background:#ffffff;'>ADMUX <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0x40</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// use adc0</span>
ADCSRA <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0xe5</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// adc prescalar</span>
</pre>
<!--Created using ToHtml.com on 2018-11-29 05:49:42 UTC -->

                <p ALIGN=LEFT>
                  The FFT libraries takes care of the actual calculations of frequencies from the analog input to FFT outputs. 
                  We had to take the necessary samples for the library to calculate:
                </p>
<pre ALIGN=LEFT style='color:#000000;background:#ffffff;'><span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>int</span> i <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span> <span style='color:#0000ff; '>;</span> i <span style='color:#0000ff; '>&lt;</span> <span style='color:#800000; '>512</span> <span style='color:#0000ff; '>;</span> i <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>2</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span> <span style='color:#008000; '>// save 256 samples</span>
    <span style='color:#0000ff; font-weight:bold; '>while</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>(</span>ADCSRA <span style='color:#0000ff; '>&amp;</span> <span style='color:#800000; '>0x10</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// wait for adc to be ready</span>
    ADCSRA <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0xf7</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// restart adc</span>
    byte m <span style='color:#0000ff; '>=</span> ADCL<span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// fetch adc data</span>
    byte j <span style='color:#0000ff; '>=</span> ADCH<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>int</span> k <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>(</span>j <span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; '>&lt;</span> <span style='color:#800000; '>8</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>|</span> m<span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// form into an int</span>
    k <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0x0200</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// form into a signed int</span>
    k <span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>6</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// form into a 16b signed int</span>
    fft_input<span style='color:#0000ff; '>[</span>i<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> k<span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// put real data into even bins</span>
    fft_input<span style='color:#0000ff; '>[</span>i<span style='color:#0000ff; '>+</span><span style='color:#800000; '>1</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// set odd bins to 0</span>
<span style='color:#0000ff; '>}</span>
fft_window<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// window the data for better frequency response</span>
fft_reorder<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// reorder the data before doing the fft</span>
fft_run<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// process the data in the fft</span>
fft_mag_log<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// take the output of the fft</span>
</pre>
                <!--Created using ToHtml.com on 2018-11-29 06:01:47 UTC -->
                
                <p ALIGN=LEFT>
                  Once this is down we can grab our data using<br/><code>fft_log_out</code><br/>
                  which hosts the stored data in bins with a specific frequency range per bin.
                </p>
                
                <h3>Acoustic Team </h3>
                
                <p ALIGN=LEFT>
                  From our analysis of the FFT and our determination of the frequency bin width, 
                  we determined that our 660Hz audio signal should fall in the fifth bin. We 
                  confirmed this by inputting a 660Hz sine wave from a function generator through 
                  a 330-ohm resistor into an analog Arduino pin and running the example fft_adc_serial 
                  code. We graphed the FFT output, as shown below. From this graph we saw our expected 
                  peak in the fifth bin.
                </p>
                <figure ALIGN=LEFT>
                    <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/lab02/fft_660.PNG" width="560"/>
                    <font size="2">
                    <figcaption> <b>FFT output from fft_adc_serial example code with 660Hz Signal from Function Generator </b>
                    </figcaption>
                    </font>
                </figure>
                <p ALIGN=LEFT>Next we created the simple microphone circuit from the lab document:</p>
                <figure ALIGN=LEFT>
                    <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/lab02/simple_microphone.PNG" width="300"/>
                    <font size="2">
                    <figcaption><b> Basic Microphone Circuit from Lab Document</b>
                    </figcaption>
                    </font>
                </figure>
                <p ALIGN=LEFT>
                  Although we had trouble getting any signal out of the microphone at first, we eventually 
                  were able to see a response on the oscilloscope when we played a 660Hz tone near the 
                  microphone from a tone generator on our phones. We observed that the amplitude of the 
                  signal was around 40 mV, and the output was unsteady and weak. 
                  <br/>
                  To amplify this signal to a more detectable and readable value, we created a simple 
                  non-inverting amplifier, starting with a modest gain of around 5 to be safe. We first 
                  tested the amplifier with an input signal from the function generator, reading the output 
                  on the oscilloscope. For a while we were not able to obtain any output signal at all. 
                  After switching our op amp from an LF353 to LM358AN, the amplifier worked as expected; 
                  we saw the desired output and amplification.
                  <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/lab02/amp_input.jpg" width = "560"/>
                  <br/>
                  <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/lab02/amp_output3.jpg" width = "560"/>
                  <br/>
                  We then put the microphone output through the amplifier. We again were not able to obtain 
                  any output signal, so we re-examined our connection between the microphone and amplifier 
                  and added a DC bias. Rather than send the simple microphone circuit output straight into 
                  the amplifier, we decided to keep the capacitor from the example circuit to remove its DC 
                  offset, and use a voltage divider to create a small, 50mV bias at the input to the amplifier. 
                  This allowed us to control our DC offset and left room for a large amplification. After 
                  solving this problem, we successfully increased our amplification to around 52. We played 
                  the 660Hz tone near the microphone and read the output to the scope to confirm that the 
                  signal was what we expected it to be. Our final design was the following amplifier circuit:
                </p>
                <figure ALIGN=LEFT>
                    <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/lab02/Acoustic.png" width="600"/>
                    <font size="2">
                    <figcaption> <b>Acoustic Amplifier Circuit Design</b>
                    </figcaption>
                    </font>
                </figure>
                <p ALIGN-LEFT>
                  Finally, we connected the output from the amplified microphone signal to an analog Arduino 
                  pin and ran the FFT code. For clarity, we plotted only the bin 5 output on the serial plotter, 
                  and watched it spike when we brought the 660Hz tone near the microphone. In an effort to 
                  filter out more ambient noise, we narrowed the bin frequency width by changing the prescalar 
                  for the ADC clock input to 128. This was done by changing the ADC Control and Status Register A:
                  <br/>
<code ALIGN=LEFT>ADCSRA = 0xe5;</code>
                  <br/>
                  Re-calculating the frequency bin width we determined we should find our 660Hz frequency in bin 19, 
                  and we confirmed this by running the FFT and plotting the results:
                  <figure ALIGN=LEFT>
                      <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/lab02/fft_660_128.PNG" width="560"/>
                      <font size="2">
                      <figcaption><b> Acoustic Amplifier Circuit Design</b>
                      </figcaption>
                      </font>
                  </figure>
                  As a finishing touch, we created a placeholder “robot start” function by lighting an LED whenever 
                  the 660Hz tone was detected, which we did by setting a threshold intensity value for bin 19 as shown 
                  in the following code:
<pre ALIGN=LEFT style='color:#000000;background:#ffffff;'><span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span>fft_log_out<span style='color:#0000ff; '>[</span><span style='color:#800000; '>18</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>></span> <span style='color:#800000; '>90</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
digitalWrite<span style='color:#0000ff; '>(</span>LED<span style='color:#0000ff; '>,</span>HIGH<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span> <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; '>{</span>
digitalWrite<span style='color:#0000ff; '>(</span>LED<span style='color:#0000ff; '>,</span>LOW<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>
</pre>
<!--Created using ToHtml.com on 2018-11-29 06:03:31 UTC -->
                  A demonstration of this detection is shown in the following video:
                </p>
                <iframe width="560" height="315" src="https://www.youtube.com/embed/JvM9OUa2xY0?controls=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                <h3>Optical</h3>
                <h5>Initial Design</h5>
                <p ALIGN=LEFT>We used the OP598A phototransistor to detect IR signals. The phototransistor was built exactly 
                like the schemamtic from the lab, with a 1.8k reistor connected to 5V power supply and the 
                photoresistor connected to ground. We first put that output into the oscilioscope and got the 
                following reading for FFT: 
                <figure ALIGN=LEFT>
                    <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/lab02/IR_FFT_without%20opamp.PNG" width="560"/>
                    <font size="2">
                    <figcaption> <b>Oscilloscope FFT of IR Sensor without augmentations</b>
                    </figcaption>
                    </font>
                </figure>
                <br/>
                The result is from turning the IR hat near the sensor. The signal strength appears to be pretty 
                strong as there are clearly readings at the 6kHz mark and all its harmonics. For the Arduino, 
                we used FFT library from Music Labs' FFT. With the library, we can check the intensity of a desired 
                frequency range to see if the it recieved any signals. We chose a 256 point FFT with a known ADC 
                sampling frequency of 38.5kHz. Therefore, each bin of the FFT has a frequency range of Fs/N or 
                around 150Hz per bin. Thus the 6.08kHz desired frequency is located at bin 40. Thus, all we have 
                to call is
                <br/>
                <code ALIGN=LEFT>fft_log_out[40];</code>
                <br/>
                to get our readings.
                </p>
                <h5>Upgraded Design</h5>
                <p ALIGN=LEFT>
                  The signal strength of the FFT at our desired bin was already strong but we wanted to implement 
                  noise filtering which means we need a filter. We also want to amplify the values in order to 
                  utilize all 10 bits of the ADC for a higher resolution reading. The Arduino Analog input can 
                  only take in voltage values from 0 to 5 volts which means that any the input voltage can’t be 
                  negative or higher than that which will result in cut off and possibly damaging the circuit. 
                  Thus, this is the resulting schematic:
                  <figure ALIGN=LEFT>
                      <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/lab02/schematic-Phototransistor%20with%20OpAmp.PNG" width="560"/>
                      <font size="2">
                      <figcaption> <b>Schematic of IR with OpAmp and bandpass filter</b>
                      </figcaption>
                      </font>
                  </figure>
                  <br/>
                  We opted with using a high pass filter to remove any DC bias inherent in the output of the sensor 
                  because the DC bias is already high at around 4v. We then amplified the filtered signal by a factor 
                  of 20 which can be adjusted as needed. The amplification seems like a good amount based on the 
                  detection strength of the IR sensor. After we amplified the signal, we ran the output through a 
                  low pass filter that removes any high frequency noise and harmonics. We chose the values of the 
                  capacitor and resistor such that the bandpass filter contains a lower cutoff frequency of 5.5kHz 
                  and higher cuttoff frequency of 6.5kHz. The formula to calculate the cutoff frequency is 1/(2*pi*RC). 
                  This completes our bandpass filter.
                </p>
                <h5>Testing</h5>
                <p ALIGN=LEFT>
                  For testing we started with unit tests by turning on the hat and holding it a certain distance from 
                  the phototransistor and check the output of the FFT printing to serial. We also implemented a blinking 
                  LED that would increase blinking rate as the IR gets closer to the phototransistor. The frequency of 
                  the blink rates tell us how close the hat is to the IR sensor. This tells us that the sensor is working 
                  as intended. In the video, the blinking is from the Arduino's internal LED although we should have used 
                  an external instead for demostration purposes.
                  <br/>
                  <iframe width="560" height="315" src="https://www.youtube.com/embed/_hD_c_GUQas?rel=0&amp;controls=0" 
                  frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                  <br/>
                  We also reedited the FFT library's codes to record FFT values in a single FFT cycle for better side by 
                  side comparison. Here are the results:
                  We divided the tests as such:
                  <ul ALIGN=LEFT>
                    <li> off: IR hat turned off
                    <li> far: IR hat 1.5 intersections away from sensor
                    <li> mid: IR hat 0.5 intersections away from sensor
                    <li> close: IR hat right next to sensor
                  </ul>
                  <br/>
                  <figure ALIGN=LEFT>
                      <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/lab02/IRnoOpAmp.PNG" width="560"/>
                      <font size="2">
                      <figcaption> <b>FFT of IR without Op Amp</b>
                      </figcaption>
                      </font>
                  </figure>
                  <br/>
                  <figure ALIGN=LEFT>
                      <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/lab02/IROpAmp.PNG" width="560"/>
                      <font size="2">
                      <figcaption> <b>FFT of IR with Op Amp</b>
                      </figcaption>
                      </font>
                  </figure>
                  <br/>
                  From these two comparisons, we can see that the op amp increases mid range performance of the IR sensor 
                  by detecting more of the IR hat's correct frequency signal whereas the harmonics appears to be more 
                  filtered out as a result of the installed bandpass filters. The long range performance appears to be 
                  unaffected by the augmentation and the close range performance clearly increased slightly.
                  <br/>
                  After testing that the sensor could detect the desired signal, we then tested the robustness of our 
                  filtering software and hardware by giving it decoy signals. We used a decoy IR signal at around 12kHz 
                  placed next to the sensor and read its FFT's. We also used the decoy to test our sensor for detecting 
                  different frequencies. 
                  <br/>
                  <figure ALIGN=LEFT>
                      <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/lab02/DecoyOpAmp.PNG" width="560"/>
                      <font size="2">
                      <figcaption> <b>FFT of Decoy </b>
                      </figcaption>
                      </font>
                  </figure>
                  <br/>
                  <figure ALIGN=LEFT>
                      <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/lab02/Decoy.PNG" width="560"/>
                      <font size="2">
                      <figcaption> <b>FFT of Decoy with Op Amp </b>
                      </figcaption>
                      </font>
                  </figure>
                  <br/>
                  We reached two conclusions with this test. The augmented sensor worked with different frequencies because 
                  the signal strengths were clearly amplified. Although for this test, it appears some of the noise were 
                  amplified as well but it was not significant. We also see that the 40th bin of the FFT is contains only 
                  background signals. This means that the signal strength will not be enough for the threshhold to detect 
                  a false positive. With these two tests, we proved that the IR sensor's hardware and software can detect 
                  the desired frequency amount and augmented it so that it detect farther away signals.  
                </p>
                <h3>Integration</h3>
                <p ALIGN=LEFT>
                  <figure ALIGN=LEFT>
                      <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/lab02/20181003_164149.jpg"
                      width="500"/>
                      <font size="2">
                      <figcaption> <b>The IR sensor and microphone together!</b>
                      </figcaption>
                      </font>
                  </figure>
                  <br/>
                  To integrate both the optical and the acoustic sensors, we first read input from the acoustic sensor 
                  through pin A0. Once we get a hit from the acoustic sensor, we switch to reading input from the IR sensor 
                  at pin A1. Both of these inputs rely on the same FFT function.
                  <br/>
                  <iframe width="560" height="315" src="https://www.youtube.com/embed/v4Z3QcfFZ4k" frameborder="0" 
                  allow="autoplay; encrypted-media" allowfullscreen></iframe>
                  <br/>
                  In order to properly incorporate this, we have put in a 5-part finite state machine. The state starts. 
                  It then moves on to recording and running the FFT on the audio. Once we record the audio, we go to 
                  process it. If the bin containing 660Hz passes its intensity threshold (meaning we've detected the 
                  tone and we need to start), we start recording IR. If not, then we go back to recording audio. From 
                  here, we continue to recording and running the FFT on the IR. If the IR surpasses its threshold 
                  (meaning a robot is detected), it writes to the serial monitor and goes back to the start. Else, it 
                  keeps recording IR. 
                    
<pre ALIGN=LEFT style='color:#000000;background:#ffffff;'><span style='color:#0000ff; font-weight:bold; '>enum</span> states<span style='color:#0000ff; '>{</span>
    START<span style='color:#0000ff; '>,</span>
    AUDIO_FFT<span style='color:#0000ff; '>,</span>
    AUDIO_PROC<span style='color:#0000ff; '>,</span>
    IR_FFT<span style='color:#0000ff; '>,</span>
    IR_PROC
<span style='color:#0000ff; '>}</span><span style='color:#0000ff; '>;</span>
uint8_t state<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; font-weight:bold; '>void</span> loop<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>

    <span style='color:#0000ff; font-weight:bold; '>switch</span> <span style='color:#0000ff; '>(</span>state<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>   
        <span style='color:#0000ff; font-weight:bold; '>case </span><span style='color:#808080; font-weight:bold; '>START</span><span style='color:#e34adc; font-weight:bold; '>:</span>
            <span style='color:#008000; '>//check point</span>
            state <span style='color:#0000ff; '>=</span> AUDIO_FFT<span style='color:#0000ff; '>;</span> <span style='color:#008000; '>//next state</span>
            <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>case </span><span style='color:#808080; font-weight:bold; '>AUDIO_FFT</span><span style='color:#e34adc; font-weight:bold; '>:</span>
            ADMUX <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0x40</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// use adc0</span>
            <span style='color:#008000; '>/*</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Some FFT array from ADC generating code....</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/</span>
            state <span style='color:#0000ff; '>=</span> AUDIO_PROC<span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>

        <span style='color:#0000ff; font-weight:bold; '>case </span><span style='color:#808080; font-weight:bold; '>AUDIO_PROC</span><span style='color:#e34adc; font-weight:bold; '>:</span>
            <span style='color:#008000; '>/*</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Processing FFT result code and check threshhold...</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/</span>
            <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span>past_some_threshhold<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
                state <span style='color:#0000ff; '>=</span> IR_PROC<span style='color:#0000ff; '>;</span> <span style='color:#008000; '>//past threshhold so we move on</span>
            <span style='color:#0000ff; '>}</span><span style='color:#0000ff; font-weight:bold; '>else</span><span style='color:#0000ff; '>{</span>
                state <span style='color:#0000ff; '>=</span> AUDIO_FFT<span style='color:#0000ff; '>;</span> <span style='color:#008000; '>//recalculate FFT with new samples</span>
            <span style='color:#0000ff; '>}</span>
            <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>

        <span style='color:#0000ff; font-weight:bold; '>case </span><span style='color:#808080; font-weight:bold; '>IR_FFT</span><span style='color:#e34adc; font-weight:bold; '>:</span>
            ADMUX <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0x41</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// use adc1</span>
            <span style='color:#008000; '>/*</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Some FFT array from ADC generating code....</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/</span>
            state <span style='color:#0000ff; '>=</span> IR_PROC<span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>

        <span style='color:#0000ff; font-weight:bold; '>case </span><span style='color:#808080; font-weight:bold; '>IR_PROC</span><span style='color:#e34adc; font-weight:bold; '>:</span>
            <span style='color:#008000; '>/*</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Processing FFT result code and check threshhold...</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/</span>
            <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span>past_some_threshhold<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
                state <span style='color:#0000ff; '>=</span> START<span style='color:#0000ff; '>;</span> <span style='color:#008000; '>//past threshhold so we move on</span>
            <span style='color:#0000ff; '>}</span><span style='color:#0000ff; font-weight:bold; '>else</span><span style='color:#0000ff; '>{</span>
                state <span style='color:#0000ff; '>=</span> IR_FFT<span style='color:#0000ff; '>;</span> <span style='color:#008000; '>//recalculate FFT with new samples</span>
            <span style='color:#0000ff; '>}</span>
            <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>  
<span style='color:#0000ff; '>}</span>
</pre>
<!--Created using ToHtml.com on 2018-11-29 06:17:21 UTC -->
                 
                </p>
                <h3>Conclusion</h3>
                <p ALIGN=LEFT>
                  We were able to integrate both the IR and microphone sensors to a single code base. This step is 
                  important as we will need to integrate all of the code from the different modules we made into the 
                  arduino. Looking forward, we would like to increase the ranges of the microphone sensors and IR 
                  sensors such that they will be able to detect the correct freqencies from farther away. This is 
                  important since the IR is used to detect other robots and the microphone is used to start the robot. 
                  We also want to explore ways to schedule our code because the sensing is a hard real time process 
                  where we have to stop the robot if it is in danger of collision and thus, we must find a way to 
                  quickly calculate the FFT and then have the robot react quick enough. A likely solution will be 
                  to use interrupts.
                </p>
              </p>
              <a class="btn btn-primary btn-lg rounded-pill portfolio-modal-dismiss" href="#">
                <i class="fa fa-close"></i>
                Close Project</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Portfolio Modal 3 -->
    <div class="portfolio-modal mfp-hide" id="portfolio-modal-3">
      <div class="portfolio-modal-dialog bg-white">
        <a class="close-button d-none d-md-block portfolio-modal-dismiss" href="#">
          <i class="fa fa-4x fa-times"></i>
        </a>
        <div class="container text-center">
          <div class="row">
            <div class="col-lg-6 mx-auto">
              <h2 class="text-secondary text-uppercase mb-0">Lab 3</h2>
              <hr class="star-dark mb-5">
              <img class="img-fluid mb-5" src="images/bootstrap/lab3-bootstrap.png" alt="">
              <p class="mb-5">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Mollitia neque assumenda ipsam nihil, molestias magnam, recusandae quos quis inventore quisquam velit asperiores, vitae? Reprehenderit soluta, eos quod consequuntur itaque. Nam.</p>
              <a class="btn btn-primary btn-lg rounded-pill portfolio-modal-dismiss" href="#">
                <i class="fa fa-close"></i>
                Close Project</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Portfolio Modal 4 -->
    <div class="portfolio-modal mfp-hide" id="portfolio-modal-4">
      <div class="portfolio-modal-dialog bg-white">
        <a class="close-button d-none d-md-block portfolio-modal-dismiss" href="#">
          <i class="fa fa-4x fa-times"></i>
        </a>
        <div class="container text-center">
          <div class="row">
            <div class="col-lg-6 mx-auto">
              <h2 class="text-secondary text-uppercase mb-0">Lab 4</h2>
              <hr class="star-dark mb-5">
              <img class="img-fluid mb-5" src="images/bootstrap/lab4-bootstrap.png" alt="">
              <p class="mb-5">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Mollitia neque assumenda ipsam nihil, molestias magnam, recusandae quos quis inventore quisquam velit asperiores, vitae? Reprehenderit soluta, eos quod consequuntur itaque. Nam.</p>
              <a class="btn btn-primary btn-lg rounded-pill portfolio-modal-dismiss" href="#">
                <i class="fa fa-close"></i>
                Close Project</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Portfolio Modal 5 -->
    <div class="portfolio-modal mfp-hide" id="portfolio-modal-5">
      <div class="portfolio-modal-dialog bg-white">
        <a class="close-button d-none d-md-block portfolio-modal-dismiss" href="#">
          <i class="fa fa-4x fa-times"></i>
        </a>
        <div class="container text-center">
          <div class="row">
            <div class="col-lg-6 mx-auto">
              <h2 class="text-secondary text-uppercase mb-0">Milestone 1: Line Follower</h2>
              <hr class="star-dark mb-5">
              <img class="img-fluid mb-5" src="img/portfolio/safe.png" alt="">
              <p class="mb-5">
                <h3>Introduction</h3>
                  <p ALIGN=LEFT>
                    The goal of this milestone was to implement line-following functionality
                    to enable our robot to both follow a straight line and trace a figure-eight 
                    pattern. To accomplish this task, we added IR sensors to the robot and 
                    implemented code for it to follow the lines and turn as directed at intersections.
                  </p>
                <h3>Hardware Upgrades</h3>
                  <p ALIGN=LEFT>
                    We spent a large amount of lab time changing the structure of the robot chassis.
                    The goal is to build a good foundation for the robot structure so that we have enough space
                    and organization later on as the robot becomes more complex.
                  </p>
                <h5>Chassis Upgrade</h5>
                  <p ALIGN=LEFT>
                    We added a second level to the robot’s chassis to support our battery, the arduino, 
                    and a breadboard for our circuits. This second level allows us to mount the battery in a secure 
                    place and creates room for additions. The spaces between the two levels can also be used to store 
                    wiring for future additional sensors and circuitry.
                  </p>
                  <figure ALIGN=LEFT>
                    <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/milestone1/20180910_213436.jpg" width="560"/>
                    <font size="3">
                    <figcaption> Front View of Robot after Adding a Second Level
                    </figcaption>
                    </font>
                  </figure>
                  <figure ALIGN=LEFT>
                    <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/milestone1/20180910_213510.jpg" width="560"/>
                    <font size="3">
                    <figcaption> Top View of Updated Chassis
                    </figcaption>
                    </font>
                  </figure>
                <h5>Robot with Breadboard on Top</h5>
                  <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/milestone1/20180913_204623.jpg" width = "560"/>
                  <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/milestone1/20180913_204628.jpg" width = "560"/>
                <p ALIGN=LEFT>
                  Adding the breadboard allowed us to create common power and ground lines and connect more
                  components than there are power and ground pins on the Arduino. We were then able to connect the line
                  sensors to the Arduino. The current breadboard is temporary, as smaller breadboards were unavailable 
                  during the lab. We plan to attach a smaller breadboard or potentially solder breadboards in order to 
                  securely and reliably attach electrical components to the board. We also plan to attach the breadboard 
                  more securely to the chassis, and will organize the wiring better especially as we add more components.
                </p>
                <h5>Line Sensor Update</h5>
                <p ALIGN=LEFT>
                  We used QRE1113 line sensors, which work by transmitting and then detecting IR light that reflects back 
                  to a phototransistor on the sensor. These sensors are mounted at the front of the robot facing downward, 
                  with the sensors only a few centimeters above the ground to maximize sensor accuracy.
                  <br/>
                  Our first design idea used three line sensors: two for staying on the line, and a third for detecting 
                  intersections.  In our final implementation, we were able to use software to perform all the required 
                  tasks using only two sensors. We then positioned the sensors further apart than they were in our initial 
                  design so that they wouldn't trigger as often and the robot would make fewer adjustments to stay on the 
                  line. This hardware update helped improve the robot's navigation speed and smoothness.
                </p>
                <figure ALIGN=LEFT>
                  <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/milestone1/20180913_204620.jpg" width="560"/>
                  <font size="3">
                  <figcaption> Front view of Robot, Final Version
                  </figcaption>
                  </font>
                </figure>
                <h5>Circuit</h5>
                <p ALIGN=LEFT>
                  Our final circuit with the sensors looked like this:
                </p>
                <figure ALIGN=LEFT>
                  <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/Schematic-RobotLineSensing.PNG" width="560"/>
                  <font size="3">
                  <figcaption> Schematic of Updated Robot with 2 Line Sensors
                  </figcaption>
                  </font>
                </figure>
                <h3>Software Design<h3>
                <p ALIGN=LEFT>
                  We used a simple software algorithm for performing these tasks. However, we also began the ground work 
                  for abstracting away some of the robot functions such as servo speed for robot forward movement and turning, 
                  which will be useful as we develop more complex algorithms to solve difficult problems later on. 
                </p>
                <h5>The Line Sensor</h5>
                <p ALIGN=LEFT>
                  We tried to use the <code>analogRead()</code> function to read input values from the sensors corresponding to 
                  the darkness of the surface, but the numbers we read were illogical and unuseable. Instead, we used 
                  digital pins to detect how long it takes to charge the sensor's phototransistor; the return values 
                  indicate the darkness of the surface. We used digital interrupts to gather data from the line sensors. 
                  The Arduino supports two digital state change interrupts which trigger an interrupt whenever the state 
                  of a digital pin changes. We used the interrupts for sensors with time sensitive operations such as 
                  following the line.
                </p>
                <h5>Code Snippet for Reading from the Line Sensor Using Digital Pins<h5>
                <pre ALIGN=LEFT>
                  <code ALIGN=LEFT>
                  volatile int SENSOR0_READING;
                  volatile int SENSOR0_TIMER;
                  int SENSOR0_PIN=2;


                  /**
                    * Triggers when the state of digital pin goes from high to low.
                    * Updates SENSOR0_READING variable.
                    */
                  void SENSOR0_ISR(){
                      SENSOR0_READING = micros() - SENSOR0_TIMER; //time difference as a result 
                      //of digital signal changing states from high to low. 
                      SENSOR0_TIMER = micros(); 
                      pinMode(SENSOR0_PIN, OUTPUT); //reset the digital pin
                      digitalWrite(SENSOR0_PIN, HIGH); //put back to high for next reading when low
                      pinMode(SENSOR0_PIN, INPUT);  
                  }


                  void setup(){
                      attachInterrupt(digitalPinToInterrupt(SENSOR0_PIN), SENSOR0_ISR, LOW);
                  }
                  </code>
                </pre>
                </p>
                <h5>Follow the Line</h5>
                <p ALIGN=LEFT>
                  To follow the line, we used simple <code>if</code> statements to adjust the robot’s path. 
                  The two line sensors detected when the robot moved too far off-center of the white 
                  line. We used a conditional to move the robot left or right when the line sensors’ 
                  values passed a certain threshold indicating they were over the white tape, and had 
                  it move straight forward when both sensors detected white tape at an intersection.
                </p>
                <h5>Code Snippet for Following the Line</h5>
                <pre ALIGN=LEFT>
                  <code ALIGN=LEFT>
                      if(SENSOR0_READING<400 && SENSOR1_READING<400){ //continue straight
                          forward();
                      }else if(SENSOR1_READING < 400){ //turning right
                          turn_right();
                      }else if(SENSOR0_READING < 400) { //turning left
                          turn _left();
                      }else{
                          forward();
                      }
                  </code>
                </pre>
                </p>
                <h5>Demonstration of Robot Following the Line</h5>
                <a><img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/milestone1/gif-followLine.gif"
                        width = "560" height = "auto"></a>
                <p ALIGN=LEFT>
                  The robot reliably follows the line. The distance between the line sensors 
                  was good enough for the robot to be "following" the line but not constantly repositioning 
                  itself; we wanted to maximize the forward moving time while turning only occasionally, 
                  when the robot moved off the line.
                  <br/>
                  Currently, the robot turns very sharply to reposition itself because we stop one wheel 
                  and move the other to create a turning motion. Moving forward, we want to smooth the 
                  robot's readjustment so that it will not lose too much speed when readjusting.
                </p>
                <h5>Figure-8</h5>
                <p ALIGN=LEFT>
                  To implement a figure-8 path, we built off the line-following code and added a conditional 
                  checking when both sensors hit a white line at an intersection.  Using an array, we created 
                  a map of the sequence of turns the robot should take at each intersection to create a 
                  figure-8, with each element of the array indicating the direction to turn. The array is 
                  repeatable such that the robot will continuously move in a figure-8 formation.
                </p>
                <pre ALIGN=LEFT>
                  <code ALIGN=LEFT>
                    char map1[] = {right,left,left,left,left,right,right,right}; //dependent on 
                    //where robot starts
                    int i=0; 
                    void loop() {
                      if(SENSOR0_READING<400 && SENSOR1_READING<400){
                        map1[i%8]==right ? turn_right() : turn_left();
                        delay(1200);
                        i++;
                      }else if(SENSOR1_READING < 400){ //turning right
                        turn_right();
                      }else if(SENSOR0_READING < 400) { //turning left
                        turn _left();
                      }else{
                        forward();
                      }
                    }
                  </code>
                </pre>
                <h5>Video of Robot Performing Figure-8</h5>
                <iframe width="560" height="315" src="https://www.youtube.com/embed/mZf0CTAzZvA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                <p ALIGN=LEFT>
                  Currently the robot doesn't turn as well as we would like; it doesn't turn for long 
                  enough and relies on the line sensors to reposition itself on the line after the turn. 
                  There is more room to optimize the robot's turn configuration either by optimizing the 
                  turn or the robot's shifting. 
                </p>
                <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/milestone1/20180913_204644.jpg" width = "340"/>
                <img src="https://raw.githubusercontent.com/PBC48/ECE-3400-Fall-2018/master/docs/images/milestone1/20180913_204557.jpg" width = "340"/>
              </p>
              <a class="btn btn-primary btn-lg rounded-pill portfolio-modal-dismiss" href="#">
                <i class="fa fa-close"></i>
                Close Project</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Portfolio Modal 6 -->
    <div class="portfolio-modal mfp-hide" id="portfolio-modal-6">
      <div class="portfolio-modal-dialog bg-white">
        <a class="close-button d-none d-md-block portfolio-modal-dismiss" href="#">
          <i class="fa fa-4x fa-times"></i>
        </a>
        <div class="container text-center">
          <div class="row">
            <div class="col-lg-6 mx-auto">
              <h2 class="text-secondary text-uppercase mb-0">Milestone 2</h2>
              <hr class="star-dark mb-5">
              <img class="img-fluid mb-5" src="img/portfolio/submarine.png" alt="">
              <p class="mb-5">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Mollitia neque assumenda ipsam nihil, molestias magnam, recusandae quos quis inventore quisquam velit asperiores, vitae? Reprehenderit soluta, eos quod consequuntur itaque. Nam.</p>
              <a class="btn btn-primary btn-lg rounded-pill portfolio-modal-dismiss" href="#">
                <i class="fa fa-close"></i>
                Close Project</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Portfolio Modal 7 -->
    <div class="portfolio-modal mfp-hide" id="portfolio-modal-7">
      <div class="portfolio-modal-dialog bg-white">
        <a class="close-button d-none d-md-block portfolio-modal-dismiss" href="#">
          <i class="fa fa-4x fa-times"></i>
        </a>
        <div class="container text-center">
          <div class="row">
            <div class="col-lg-6 mx-auto">
              <h2 class="text-secondary text-uppercase mb-0">Milestone 3</h2>
              <hr class="star-dark mb-5">
              <img class="img-fluid mb-5" src="img/portfolio/submarine.png" alt="">
              <p class="mb-5">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Mollitia neque assumenda ipsam nihil, molestias magnam, recusandae quos quis inventore quisquam velit asperiores, vitae? Reprehenderit soluta, eos quod consequuntur itaque. Nam.</p>
              <a class="btn btn-primary btn-lg rounded-pill portfolio-modal-dismiss" href="#">
                <i class="fa fa-close"></i>
                Close Project</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Portfolio Modal 8 -->
    <div class="portfolio-modal mfp-hide" id="portfolio-modal-8">
      <div class="portfolio-modal-dialog bg-white">
        <a class="close-button d-none d-md-block portfolio-modal-dismiss" href="#">
          <i class="fa fa-4x fa-times"></i>
        </a>
        <div class="container text-center">
          <div class="row">
            <div class="col-lg-6 mx-auto">
              <h2 class="text-secondary text-uppercase mb-0">Milestone 4</h2>
              <hr class="star-dark mb-5">
              <img class="img-fluid mb-5" src="img/portfolio/submarine.png" alt="">
              <p class="mb-5">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Mollitia neque assumenda ipsam nihil, molestias magnam, recusandae quos quis inventore quisquam velit asperiores, vitae? Reprehenderit soluta, eos quod consequuntur itaque. Nam.</p>
              <a class="btn btn-primary btn-lg rounded-pill portfolio-modal-dismiss" href="#">
                <i class="fa fa-close"></i>
                Close Project</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
    <script src="vendor/magnific-popup/jquery.magnific-popup.min.js"></script>

    <!-- Contact Form JavaScript -->
    <script src="js/jqBootstrapValidation.js"></script>
    <script src="js/contact_me.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/freelancer.min.js"></script>

  </body>

</html>
